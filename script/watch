#!/usr/bin/env coffee

chokidar = require 'chokidar'
sys = require 'sys'
exec = require('child_process').exec
growl = require 'growl'

puts = (error, stdout, stderr) -> sys.puts(stdout)

buildAll = ->
  ret = exec("make build-all", puts)
  title = 'Build Status'
  if ret.exitCode is null
    growl '✓✓✓ Success ✓✓✓', {title: title}
  else
    growl '⌦ FAILURE ⌫', {title: title}

watcher = chokidar.watch 'src', {persistent: true}

watcher
  .on('add', buildAll)
  .on('change', buildAll)
  .on('unlink', buildAll)
  .on('error', (error) -> console.log "An error occurred:", error)
